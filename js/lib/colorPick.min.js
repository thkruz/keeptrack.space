!(function (o) {
  ;(o.fn.colorPick = function (e) {
    return this.each(function () {
      new o.colorPick(this, e || {})
    })
  }),
    (o.colorPick = function (e, t) {
      ;(t = t || {}),
        (this.options = o.extend({}, o.fn.colorPick.defaults, t)),
        t.str &&
          (this.options.str = o.extend({}, o.fn.colorPick.defaults.str, t.str)),
        (o.fn.colorPick.defaults = this.options),
        (this.color = this.options.initialColor.toUpperCase()),
        (this.element = o(e))
      var c = this.element.data('initialcolor')
      c && ((this.color = c), this.appendToStorage(this.color))
      var l = []
      return (
        o.each(
          o.fn.colorPick.defaults.palette.map(function (o) {
            return o.toUpperCase()
          }),
          function (e, t) {
            ;-1 === o.inArray(t, l) && l.push(t)
          },
        ),
        (this.palette = l),
        this.element.hasClass(this.options.pickrclass) ? this : this.init()
      )
    }),
    (o.fn.colorPick.defaults = {
      initialColor: '#3498db',
      paletteLabel: '',
      allowRecent: !1,
      recentMax: 5,
      allowCustomColor: !1,
      palette: [
        '#1abc9c',
        '#16a085',
        '#2ecc71',
        '#27ae60',
        '#3498db',
        '#2980b9',
        '#9b59b6',
        '#8e44ad',
        '#34495e',
        '#2c3e50',
        '#f1c40f',
        '#f39c12',
        '#e67e22',
        '#d35400',
        '#e74c3c',
        '#c0392b',
        '#ecf0f1',
        '#bdc3c7',
        '#95a5a6',
        '#7f8c8d',
      ],
      onColorSelected: function () {
        this.element.css({ backgroundColor: this.color, color: this.color })
      },
    }),
    (o.colorPick.prototype = {
      init: function () {
        var e = this
        this.options
        return (
          o.proxy(o.fn.colorPick.defaults.onColorSelected, this)(),
          this.element
            .on('click', function (t) {
              return (
                t.preventDefault(),
                e.show(t.pageX, t.pageY),
                o('.customColorHash').val(e.color),
                o('.colorPickButton').on('click', function (t) {
                  return (
                    (e.color = o(t.target).attr('hexValue')),
                    e.appendToStorage(o(t.target).attr('hexValue')),
                    e.hide(),
                    o.proxy(e.options.onColorSelected, e)(),
                    !1
                  )
                }),
                o('.customColorHash')
                  .on('click', function (o) {
                    return !1
                  })
                  .on('keyup', function (t) {
                    var c = o(this).val()
                    0 !== c.indexOf('#') && (c = '#' + c),
                      /(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(c)
                        ? ((e.color = c),
                          e.appendToStorage(c),
                          o.proxy(e.options.onColorSelected, e)(),
                          o(this).removeClass('error'))
                        : o(this).addClass('error')
                  }),
                !1
              )
            })
            .on('blur', function () {
              return (
                e.element.val(e.color),
                o.proxy(e.options.onColorSelected, e)(),
                e.hide(),
                !1
              )
            }),
          o(document).on('click', function (o) {
            return e.hide(), !0
          }),
          this
        )
      },
      appendToStorage: function (e) {
        if (!0 === o.fn.colorPick.defaults.allowRecent) {
          var t = JSON.parse(localStorage.getItem('colorPickRecentItems'))
          null == t && (t = []),
            -1 == o.inArray(e, t) &&
              (t.unshift(e),
              (t = t.slice(0, o.fn.colorPick.defaults.recentMax)),
              localStorage.setItem('colorPickRecentItems', JSON.stringify(t)))
        }
      },
      show: function (e, t) {
        o('#colorPick').remove(),
          o('body').append(
            '<div id="colorPick" style="display:none;top:' +
              t +
              'px;left:' +
              e +
              'px"><span>' +
              o.fn.colorPick.defaults.paletteLabel +
              '</span></div>',
          ),
          jQuery.each(this.palette, function (e, t) {
            o('#colorPick').append(
              '<div class="colorPickButton" hexValue="' +
                t +
                '" style="background:' +
                t +
                '"></div>',
            )
          }),
          !0 === o.fn.colorPick.defaults.allowCustomColor &&
            o('#colorPick').append(
              '<input type="text" style="margin-top:5px" class="customColorHash" />',
            ),
          !0 === o.fn.colorPick.defaults.allowRecent &&
            (o('#colorPick').append(
              '<span style="margin-top:5px">Recent:</span>',
            ),
            null == JSON.parse(localStorage.getItem('colorPickRecentItems')) ||
            JSON.parse(localStorage.getItem('colorPickRecentItems')) == []
              ? o('#colorPick').append(
                  '<div class="colorPickButton colorPickDummy"></div>',
                )
              : jQuery.each(
                  JSON.parse(localStorage.getItem('colorPickRecentItems')),
                  function (e, t) {
                    if (
                      (o('#colorPick').append(
                        '<div class="colorPickButton" hexValue="' +
                          t +
                          '" style="background:' +
                          t +
                          '"></div>',
                      ),
                      e == o.fn.colorPick.defaults.recentMax - 1)
                    )
                      return !1
                  },
                )),
          o('#colorPick').fadeIn(200)
      },
      hide: function () {
        o('#colorPick').fadeOut(200, function () {
          return o('#colorPick').remove(), this
        })
      },
    })
})(jQuery)

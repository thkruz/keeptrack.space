var gl,pitchRotate,yawRotate,pickFb,pickTex,pickColorBuf,fpsEl,fpsAz,drawLoopCallback,debugTimeArray=[],timeManager=window.timeManager,satCruncher=window.satCruncher,camYaw=0,camPitch=.5,camYawTarget=0,camPitchTarget=0,camSnapMode=!1,camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1,zoomLevel=.5,zoomTarget=.5,isZoomIn=!1,camPitchSpeed=0,camYawSpeed=0,camRotateSpeed=0,isEditSatMenuOpen=!1,isDOPMenuOpen=!1,isLookanglesMenuOpen=!1,isLookanglesMultiSiteMenuOpen=!1,isNewLaunchMenuOpen=!1,isBreakupMenuOpen=!1,isMissileMenuOpen=!1,isPlanetariumView=!1,isAstronomyView=!1,isSatView=!1,isVideoRecording=!1,isCustomSensorMenuOpen=!1,pMatrix=mat4.create(),camMatrix=mat4.create(),camMatrixEmpty=mat4.create(),selectedSat=-1,lastSelectedSat=-1,drawLineList=[],updateHoverDelay=0,updateHoverDelayLimit=1,cameraType={current:0,DEFAULT:0,OFFSET:1,FPS:2,PLANETARIUM:3,SATELLITE:4,ASTRONOMY:5},mouseX=0,mouseY=0,mouseTimeout=null,mouseSat=-1,isMouseMoving=!1,dragPoint=[0,0,0],screenDragPoint=[0,0],dragStartPitch=0,dragStartYaw=0,isDragging=!1,dragHasMoved=!1,isPinching=!1,deltaPinchDistance=0,startPinchDistance=0,fpsPitch=0,fpsPitchRate=0,fpsRotate=0,fpsRotateRate=0,fpsYaw=0,fpsYawRate=0,fpsXPos=0,fpsYPos=25e3,fpsZPos=0,fpsForwardSpeed=0,fpsSideSpeed=0,fpsVertSpeed=0,isFPSForwardSpeedLock=!1,isFPSSideSpeedLock=!1,isFPSVertSpeedLock=!1,fpsRun=1,fpsLastTime=1,satScreenPositionArray={},isShowNextPass=!1,rotateTheEarth=!0;function webGlInit(){db.log("webGlInit");var e=canvasDOM[0];e.width=window.innerWidth,e.height=window.innerHeight;var a=e.getContext("webgl",{alpha:!1,desynchronized:!0})||e.getContext("experimental-webgl",{alpha:!1,desynchronized:!0});a||browserUnsupported(),a.viewport(0,0,e.width,e.height),a.enable(a.DEPTH_TEST);var t=a.createShader(a.FRAGMENT_SHADER),s=shaderLoader.getShaderCode("pick-fragment.glsl");a.shaderSource(t,s),a.compileShader(t);var r=a.createShader(a.VERTEX_SHADER),i=shaderLoader.getShaderCode("pick-vertex.glsl");a.shaderSource(r,i),a.compileShader(r);var n=a.createProgram();a.attachShader(n,r),a.attachShader(n,t),a.linkProgram(n),n.aPos=a.getAttribLocation(n,"aPos"),n.aColor=a.getAttribLocation(n,"aColor"),n.aPickable=a.getAttribLocation(n,"aPickable"),n.uCamMatrix=a.getUniformLocation(n,"uCamMatrix"),n.uMvMatrix=a.getUniformLocation(n,"uMvMatrix"),n.uPMatrix=a.getUniformLocation(n,"uPMatrix"),a.pickShaderProgram=n,pickFb=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,pickFb),pickTex=a.createTexture(),a.bindTexture(a.TEXTURE_2D,pickTex),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.drawingBufferWidth,a.drawingBufferHeight,0,a.RGBA,a.UNSIGNED_BYTE,null);var o=a.createRenderbuffer();a.bindRenderbuffer(a.RENDERBUFFER,o),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,a.drawingBufferWidth,a.drawingBufferHeight),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,pickTex,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,o),a.pickFb=pickFb,pickColorBuf=new Uint8Array(4),pMatrix=mat4.create(),mat4.perspective(pMatrix,settingsManager.fieldOfView,a.drawingBufferWidth/a.drawingBufferHeight,20,6e5);mat4.mul(pMatrix,pMatrix,[1,0,0,0,0,0,-1,0,0,1,0,0,0,0,0,1]),window.gl=a}function _getCamDist(){return db.log("_getCamDist",!0),Math.pow(zoomLevel,ZOOM_EXP)*(DIST_MAX-DIST_MIN)+DIST_MIN}function _unProject(e,a){return glScreenX=e/gl.drawingBufferWidth*2-1,glScreenY=1-a/gl.drawingBufferHeight*2,screenVec=[glScreenX,glScreenY,-.01,1],comboPMat=mat4.create(),mat4.mul(comboPMat,pMatrix,camMatrix),invMat=mat4.create(),mat4.invert(invMat,comboPMat),worldVec=vec4.create(),vec4.transformMat4(worldVec,screenVec,invMat),[worldVec[0]/worldVec[3],worldVec[1]/worldVec[3],worldVec[2]/worldVec[3]]}function _normalizeAngle(e){return(e%=TAU)>Math.PI&&(e-=TAU),e<-Math.PI&&(e+=TAU),e}function getSatIdFromCoord(e,a){return gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.readPixels(e,gl.drawingBufferHeight-a,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pickColorBuf),(pickColorBuf[2]<<16|pickColorBuf[1]<<8|pickColorBuf[0])-1}function getEarthScreenPoint(e,a){return rayOrigin=getCamPos(),ptThru=_unProject(e,a),rayDir=vec3.create(),vec3.subtract(rayDir,ptThru,rayOrigin),vec3.normalize(rayDir,rayDir),toCenterVec=vec3.create(),vec3.scale(toCenterVec,rayOrigin,-1),dParallel=vec3.dot(rayDir,toCenterVec),longDir=vec3.create(),vec3.scale(longDir,rayDir,dParallel),vec3.add(ptThru,rayOrigin,longDir),dPerp=vec3.len(ptThru),dSubSurf=Math.sqrt(RADIUS_OF_EARTH*RADIUS_OF_EARTH-dPerp*dPerp),dSurf=dParallel-dSubSurf,ptSurf=vec3.create(),vec3.scale(ptSurf,rayDir,dSurf),vec3.add(ptSurf,ptSurf,rayOrigin),ptSurf}function getCamPos(){return gCPr=_getCamDist(),gCPz=gCPr*Math.sin(camPitch),gCPrYaw=gCPr*Math.cos(camPitch),gCPx=gCPrYaw*Math.sin(camYaw),gCPy=gCPrYaw*-Math.cos(camYaw),[gCPx,gCPy,gCPz]}function longToYaw(e){var a=$("#datetime-text").text().substr(0,19),t=new Date;a=a.split(" "),a=new Date(a[0]+"T"+a[1]+"Z"),t.setUTCHours(a.getUTCHours()+2*a.getUTCMonth()-10),t.setUTCMinutes(a.getUTCMinutes()),t.setUTCSeconds(a.getUTCSeconds()),a.setUTCHours(0),a.setUTCMinutes(0),a.setUTCSeconds(0);var s=(t-a)/60/60/1e3;return s>24&&(s-=24),_normalizeAngle((e+(s*=15))*DEG2RAD)}function latToPitch(e){var a=e*DEG2RAD;return a>TAU/4&&(a=TAU/4),a<-TAU/4&&(a=-TAU/4),a}function camSnap(e,a){camPitchTarget=e,camYawTarget=_normalizeAngle(a),camSnapMode=!0}function changeZoom(e){zoomTarget="geo"!==e?"leo"!==e?e:.45:.82}!function(){var e,a,t,s,r,i,n,o,c,d,l,m,p,S,g,u,M,f,h,w=75e-6,L=!1,T=!0;$(document).ready(function(){void 0===settingsManager.tleSource&&(settingsManager.tleSource="tle/TLE.json"),webGlInit(),atmosphere.init(),earth.init(),ColorScheme.init(),satSet.init(function(e){$("#loader-text").text("Coloring Inside the Lines..."),orbitDisplay.init(),groups.init(),searchBox.init(e)}),x()});var v=0;function x(){if(requestAnimationFrame(x),a=Date.now(),t=a-(e||a),void 0!==v){if(++v>100)return void(v=null);v>50&&t>500&&settingsManager.isSlowCPUModeEnabled}if(t>20?updateHoverDelayLimit=10:t>50?updateHoverDelayLimit=15:updateHoverDelayLimit>1&&--updateHoverDelayLimit,e=a,timeManager.now=a,isDragging&&!settingsManager.isMobileModeEnabled||isDragging&&settingsManager.isMobileModeEnabled&&(0!==mouseX||0!==mouseY)?(n=getEarthScreenPoint(mouseX,mouseY),isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(dragPoint[0])||isNaN(dragPoint[1])||isNaN(dragPoint[2])||cameraType.current===cameraType.FPS||cameraType.current===cameraType.SATELLITE||cameraType.current===cameraType.ASTRONOMY||settingsManager.isMobileModeEnabled?(o=screenDragPoint[0]-mouseX,c=screenDragPoint[1]-mouseY,d=dragStartYaw+o*settingsManager.cameraMovementSpeed,l=dragStartPitch+c*-settingsManager.cameraMovementSpeed,camPitchSpeed=_normalizeAngle(camPitch-l)*-settingsManager.cameraMovementSpeed,camYawSpeed=_normalizeAngle(camYaw-d)*-settingsManager.cameraMovementSpeed):(m=Math.sqrt(dragPoint[0]*dragPoint[0]+dragPoint[1]*dragPoint[1]),p=Math.sqrt(n[0]*n[0]+n[1]*n[1]),S=Math.atan2(dragPoint[1],dragPoint[0]),g=Math.atan2(n[1],n[0]),u=Math.atan2(dragPoint[2],m),M=Math.atan2(n[2],p),f=u-M,h=_normalizeAngle(S-g),camPitchSpeed=f*settingsManager.cameraMovementSpeed,camYawSpeed=h*settingsManager.cameraMovementSpeed),camSnapMode=!1):settingsManager.isMobileModeEnabled?settingsManager.isMobileModeEnabled&&(camPitchSpeed-=camPitchSpeed*t*settingsManager.cameraMovementSpeed*5,camYawSpeed-=camYawSpeed*t*settingsManager.cameraMovementSpeed*5):(camPitchSpeed-=camPitchSpeed*t*settingsManager.cameraMovementSpeed,camYawSpeed-=camYawSpeed*t*settingsManager.cameraMovementSpeed),camRotateSpeed-=camRotateSpeed*t*settingsManager.cameraMovementSpeed,cameraType.current===cameraType.FPS||cameraType.current===cameraType.SATELLITE||cameraType.current===cameraType.ASTRONOMY?(fpsYaw-=20*camYawSpeed*t,fpsRotate-=20*camRotateSpeed*t,(fpsPitch-=20*camPitchSpeed*t)>90&&(fpsPitch=90),fpsPitch<-90&&(fpsPitch=-90),cameraType.current===cameraType.ASTRONOMY?(fpsRotate>90&&(fpsRotate=90),fpsRotate<-90&&(fpsRotate=-90)):(fpsRotate>360&&(fpsRotate-=360),fpsRotate<0&&(fpsRotate+=360)),fpsYaw>360&&(fpsYaw-=360),fpsYaw<0&&(fpsYaw+=360)):(camPitch+=camPitchSpeed*t,camYaw+=camYawSpeed*t,fpsRotate+=camRotateSpeed*t),rotateTheEarth&&(camYaw-=w*t),zoomLevel!==zoomTarget&&atmosphere.resize(),camSnapMode){camPitch+=.003*(camPitchTarget-camPitch)*t;let e=_normalizeAngle(camYawTarget-camYaw);camYaw+=.003*e*t,zoomLevel+=(zoomTarget-zoomLevel)*t*.0025}else isZoomIn?zoomLevel-=zoomLevel*t/100*Math.abs(zoomTarget-zoomLevel):zoomLevel+=zoomLevel*t/100*Math.abs(zoomTarget-zoomLevel),(zoomLevel>=zoomTarget&&!isZoomIn||zoomLevel<=zoomTarget&&isZoomIn)&&(zoomLevel=zoomTarget);if(camPitch>TAU/4&&(camPitch=TAU/4),camPitch<-TAU/4&&(camPitch=-TAU/4),camYaw=_normalizeAngle(camYaw),-1!==selectedSat){let e=satSet.getSat(selectedSat);e.static||function(e){if(camAngleSnappedOnSat){var a=e.position,t=Math.sqrt(a.x*a.x+a.y*a.y),s=Math.atan2(a.y,a.x)+TAU/4,r=Math.atan2(a.z,t);r||(console.warn("Pitch Calculation Error"),r=0,camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1),s||(console.warn("Yaw Calculation Error"),s=0,camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1),cameraType.current===cameraType.PLANETARIUM||camSnap(r,s)}if(camZoomSnappedOnSat){var i,n;e.missile||e.static||!e.active||(i=e.getAltitude()),e.missile&&(i=e.maxAlt+1e3,orbitDisplay.setSelectOrbit(e.satId)),i?n=i+RADIUS_OF_EARTH+settingsManager.camDistBuffer:(n=RADIUS_OF_EARTH+settingsManager.camDistBuffer,console.warn("Zoom Calculation Error: "+i+" -- "+n),camZoomSnappedOnSat=!1,camAngleSnappedOnSat=!1),Math.pow((n-DIST_MIN)/(DIST_MAX-DIST_MIN),1/ZOOM_EXP)<zoomTarget&&(zoomTarget=Math.pow((n-DIST_MIN)/(DIST_MAX-DIST_MIN),1/ZOOM_EXP))}cameraType.current===cameraType.PLANETARIUM&&(zoomTarget=.01)}(e),e.static&&(cameraType.current,cameraType.PLANETARIUM)}if("undefined"!=typeof missileManager&&missileManager.missileArray.length>0)for(var L=0;L<missileManager.missileArray.length;L++)orbitDisplay.updateOrbitBuffer(missileManager.missileArray[L].id);!function(){gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),gl.bindFramebuffer(gl.FRAMEBUFFER,null),(cameraType.current===cameraType.FPS||cameraType.current===cameraType.SATELLITE||cameraType.current===cameraType.ASTRONOMY)&&function(){r=Date.now(),0!==fpsLastTime&&(i=r-fpsLastTime,isFPSForwardSpeedLock&&fpsForwardSpeed<0?fpsForwardSpeed=Math.max(fpsForwardSpeed+Math.min(-1.02*fpsForwardSpeed*i,-.2),-settingsManager.fpsForwardSpeed):isFPSForwardSpeedLock&&fpsForwardSpeed>0&&(fpsForwardSpeed=Math.min(fpsForwardSpeed+Math.max(1.02*fpsForwardSpeed*i,.2),settingsManager.fpsForwardSpeed)),isFPSSideSpeedLock&&fpsSideSpeed<0?fpsSideSpeed=Math.max(fpsSideSpeed+Math.min(-1.02*fpsSideSpeed*i,-.2),-settingsManager.fpsSideSpeed):isFPSSideSpeedLock&&fpsSideSpeed<0&&(fpsSideSpeed=Math.min(fpsSideSpeed+Math.max(1.02*fpsSideSpeed*i,.2),settingsManager.fpsSideSpeed)),isFPSVertSpeedLock&&fpsVertSpeed<0?fpsVertSpeed=Math.max(fpsVertSpeed+Math.min(-1.02*fpsVertSpeed*i,-.2),-settingsManager.fpsVertSpeed):isFPSVertSpeedLock&&fpsVertSpeed<0&&(fpsVertSpeed=Math.min(fpsVertSpeed+Math.max(1.02*fpsVertSpeed*i,.2),settingsManager.fpsVertSpeed)),cameraType.FPS&&(0!==fpsForwardSpeed&&(fpsXPos-=Math.sin(fpsYaw*DEG2RAD)*fpsForwardSpeed*fpsRun*i,fpsYPos-=Math.cos(fpsYaw*DEG2RAD)*fpsForwardSpeed*fpsRun*i,fpsZPos+=Math.sin(fpsPitch*DEG2RAD)*fpsForwardSpeed*fpsRun*i),0!==fpsVertSpeed&&(fpsZPos-=fpsVertSpeed*fpsRun*i),0!==fpsSideSpeed&&(fpsXPos-=Math.cos(-fpsYaw*DEG2RAD)*fpsSideSpeed*fpsRun*i,fpsYPos-=Math.sin(-fpsYaw*DEG2RAD)*fpsSideSpeed*fpsRun*i)),isFPSForwardSpeedLock||(fpsForwardSpeed*=Math.min(.98*i,.98)),isFPSSideSpeedLock||(fpsSideSpeed*=Math.min(.98*i,.98)),isFPSVertSpeedLock||(fpsVertSpeed*=Math.min(.98*i,.98)),fpsForwardSpeed<.01&&fpsForwardSpeed>-.01&&(fpsForwardSpeed=0),fpsSideSpeed<.01&&fpsSideSpeed>-.01&&(fpsSideSpeed=0),fpsVertSpeed<.01&&fpsVertSpeed>-.01&&(fpsVertSpeed=0),fpsPitch+=fpsPitchRate*i,fpsRotate+=fpsRotateRate*i,fpsYaw+=fpsYawRate*i);fpsLastTime=r}();camMatrix=function(){switch(camMatrix=camMatrixEmpty,mat4.identity(camMatrix),(isNaN(camPitch)||isNaN(camYaw)||isNaN(camPitchTarget)||isNaN(camYawTarget)||isNaN(zoomLevel)||isNaN(zoomTarget))&&(camPitch=.5,camYaw=.5,zoomLevel=.5,camPitchTarget=0,camYawTarget=0,zoomTarget=.5,console.error("Camera Math Error - Camera Reset")),cameraType.current){case cameraType.DEFAULT:mat4.translate(camMatrix,camMatrix,[0,_getCamDist(),0]),mat4.rotateX(camMatrix,camMatrix,camPitch),mat4.rotateZ(camMatrix,camMatrix,-camYaw);break;case cameraType.OFFSET:mat4.translate(camMatrix,camMatrix,[15e3,_getCamDist(),-6e3]),mat4.rotateX(camMatrix,camMatrix,camPitch),mat4.rotateZ(camMatrix,camMatrix,-camYaw);break;case cameraType.FPS:mat4.rotate(camMatrix,camMatrix,-fpsPitch*DEG2RAD,[1,0,0]),mat4.rotate(camMatrix,camMatrix,fpsYaw*DEG2RAD,[0,0,1]),mat4.translate(camMatrix,camMatrix,[fpsXPos,fpsYPos,-fpsZPos]);break;case cameraType.PLANETARIUM:{let e=b({});pitchRotate=-1*sensorManager.currentSensor.lat*DEG2RAD,yawRotate=(90-sensorManager.currentSensor.long)*DEG2RAD-e.gmst,mat4.rotate(camMatrix,camMatrix,pitchRotate,[1,0,0]),mat4.rotate(camMatrix,camMatrix,yawRotate,[0,0,1]),mat4.translate(camMatrix,camMatrix,[-e.x,-e.y,-e.z]),R();break}case cameraType.SATELLITE:{-1!==selectedSat&&(lastSelectedSat=selectedSat);let e=satSet.getSat(lastSelectedSat);mat4.rotate(camMatrix,camMatrix,-fpsPitch*DEG2RAD,[1,0,0]),mat4.rotate(camMatrix,camMatrix,fpsYaw*DEG2RAD,[0,0,1]),mat4.rotate(camMatrix,camMatrix,fpsRotate*DEG2RAD,[0,1,0]),orbitDisplay.updateOrbitBuffer(lastSelectedSat);let a=e.position;mat4.translate(camMatrix,camMatrix,[-a.x,-a.y,-a.z]);break}case cameraType.ASTRONOMY:{let e=b({});pitchRotate=-1*sensorManager.currentSensor.lat*DEG2RAD,yawRotate=(90-sensorManager.currentSensor.long)*DEG2RAD-e.gmst;let a=null;if(void 0===sensorManager.currentSensor.name){if(null==(a=satSet.getIdFromSensorName(sensorManager.currentSensor.name)))return}else a=satSet.getSat(satSet.getIdFromSensorName(sensorManager.currentSensor.name));mat4.rotate(camMatrix,camMatrix,pitchRotate+-fpsPitch*DEG2RAD,[1,0,0]),mat4.rotate(camMatrix,camMatrix,yawRotate+fpsYaw*DEG2RAD,[0,0,1]),mat4.rotate(camMatrix,camMatrix,fpsRotate*DEG2RAD,[0,1,0]);let t=a.position;fpsXPos=t.x,fpsYPos=t.y,fpsZPos=t.z,mat4.translate(camMatrix,camMatrix,[1.01*-t.x,1.01*-t.y,1.01*-t.z]),R();break}}return camMatrix}(),gl.useProgram(gl.pickShaderProgram),gl.uniformMatrix4fv(gl.pickShaderProgram.uPMatrix,!1,pMatrix),gl.uniformMatrix4fv(gl.pickShaderProgram.camMatrix,!1,camMatrix),gl.clearColor(0,0,0,1),gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT),cameraType.current!=cameraType.FPS&&atmosphere.draw(pMatrix,camMatrix);earth.draw(pMatrix,camMatrix),satSet.draw(pMatrix,camMatrix,a),orbitDisplay.draw(pMatrix,camMatrix)}(),drawLines(),function(){if(searchBox.getLastResultGroup(),searchBox.isHovering())s=searchBox.getHoverSat(),satSet.getScreenCoords(s,pMatrix,camMatrix),e=satScreenPositionArray.x,a=satScreenPositionArray.y,gl.bindFramebuffer(gl.FRAMEBUFFER,gl.pickFb),gl.readPixels(e,gl.drawingBufferHeight-a,1,1,gl.RGBA,gl.UNSIGNED_BYTE,pickColorBuf),0!==pickColorBuf[0]||0!==pickColorBuf[1]||0!==pickColorBuf[2]?A(s,satScreenPositionArray.x,satScreenPositionArray.y):A(-1,0,0);else{if(!isMouseMoving||isDragging||settingsManager.isMobileModeEnabled)return;++updateHoverDelay>=updateHoverDelayLimit&&(updateHoverDelay=0,mouseSat=getSatIdFromCoord(mouseX,mouseY)),-1!==mouseSat?orbitDisplay.setHoverOrbit(mouseSat):orbitDisplay.clearHoverOrbit(),satSet.setHover(mouseSat),A(mouseSat,mouseX,mouseY)}var e,a}(),function(e){if(void 0===e)return;e()}(drawLoopCallback),settingsManager.isDemoModeOn&&function(){if(objectManager.isSensorManagerLoaded&&!sensorManager.checkSensorSelected())return;if(a-I<settingsManager.demoModeInterval)return;I=a,F===satSet.getSatData().length&&(F=0);for(var e=F;e<satSet.getSatData().length;e++){var t=satSet.getSat(e);if(!t.static&&!(t.missile||1===t.OT&&!1===ColorScheme.objectTypeFlags.payload||2===t.OT&&!1===ColorScheme.objectTypeFlags.rocketBody||3===t.OT&&!1===ColorScheme.objectTypeFlags.debris||t.inview&&!1===ColorScheme.objectTypeFlags.inFOV||(satSet.getScreenCoords(e,pMatrix,camMatrix),satScreenPositionArray.error||void 0===satScreenPositionArray.x||void 0===satScreenPositionArray.y||satScreenPositionArray.x>window.innerWidth||satScreenPositionArray.y>window.innerHeight)))return A(e,satScreenPositionArray.x,satScreenPositionArray.y),orbitDisplay.setSelectOrbit(e),void(F=e+1)}}(),settingsManager.isSatLabelModeOn&&cameraType.current===cameraType.PLANETARIUM||(D&&$("#sat-minibox").html(""),D=!1)}function b(e){var a,t,s,r,i,n,o=timeManager.propTime(),c=(a=o.getUTCFullYear(),t=o.getUTCMonth()+1,s=o.getUTCDate(),r=o.getUTCHours(),i=o.getUTCMinutes(),n=o.getUTCSeconds(),367*a-Math.floor(7*(a+Math.floor((t+9)/12))*.25)+Math.floor(275*t/9)+s+1721013.5+((n/60+i)/60+r)/24);c+=1.15741e-8*o.getUTCMilliseconds();var d=satellite.gstime(c),l=Math.cos(sensorManager.currentSensor.lat*DEG2RAD),m=Math.sin(sensorManager.currentSensor.lat*DEG2RAD),p=Math.cos(sensorManager.currentSensor.long*DEG2RAD+d),S=Math.sin(sensorManager.currentSensor.long*DEG2RAD+d);return e.x=(RADIUS_OF_EARTH+PLANETARIUM_DIST)*l*p,e.y=(RADIUS_OF_EARTH+PLANETARIUM_DIST)*l*S,e.z=(RADIUS_OF_EARTH+PLANETARIUM_DIST)*m,e.gmst=d,e}var P,y,C=0,D=!1,E=[];function R(){if(!settingsManager.isSatLabelModeOn||cameraType.current!==cameraType.PLANETARIUM)return D&&$("#sat-minibox").html(""),void(D=!1);if(sensorManager.checkSensorSelected()&&!(a-C<settingsManager.satLabelInterval)){var e;orbitDisplay.clearInViewOrbit(),P=0,L=!0,(E=document.getElementById("sat-minibox")).innerHTML="";for(var t=0;t<satSet.orbitalSats&&P<settingsManager.maxLabels;t++)(e=satSet.getSatPosOnly(t)).static||e.missile||1===e.OT&&!1===ColorScheme.objectTypeFlags.payload||2===e.OT&&!1===ColorScheme.objectTypeFlags.rocketBody||3===e.OT&&!1===ColorScheme.objectTypeFlags.debris||e.inview&&!1===ColorScheme.objectTypeFlags.inFOV||(satSet.getScreenCoords(t,pMatrix,camMatrix,e.position),satScreenPositionArray.error||void 0!==satScreenPositionArray.x&&void 0!==satScreenPositionArray.y&&(satScreenPositionArray.x>window.innerWidth||satScreenPositionArray.y>window.innerHeight||(orbitDisplay.addInViewOrbit(t),(y=document.createElement("div")).id="sat-minibox-"+t,y.textContent=e.SCC_NUM,y.setAttribute("style","display: block; position: absolute; left: "+satScreenPositionArray.x+"10px; top: "+satScreenPositionArray.y+"px;"),E.appendChild(y),P++)));D=!0,C=a}}function A(e,a,t){if(cameraType.current===cameraType.PLANETARIUM&&!settingsManager.isDemoModeOn)return satHoverBoxDOM.css({display:"none"}),void(-1===e?canvasDOM.css({cursor:"default"}):canvasDOM.css({cursor:"pointer"}));if(-1===e){if(!L||settingsManager.isDisableSatHoverBox)return;objectManager.isStarManagerLoaded&&(!0!==starManager.isConstellationVisible||starManager.isAllConstellationVisible||starManager.clearConstellations()),satHoverBoxDOM.css({display:"none"}),canvasDOM.css({cursor:"default"}),L=!1}else if(!isDragging&&!settingsManager.isDisableSatHoverBox){var s=satSet.getSatExtraOnly(e),r=satSet.getSatExtraOnly(selectedSat);if(L=!0,s.static)if("Launch Facility"===s.type){var i=objectManager.extractLaunchSite(s.name);satHoverBoxNode1.textContent=i.site+", "+i.sitec,satHoverBoxNode2.innerHTML=s.type+satellite.distance(s,r)+"",satHoverBoxNode3.textContent=""}else"Control Facility"===s.type?(satHoverBoxNode1.textContent=s.name,satHoverBoxNode2.innerHTML=s.typeExt+satellite.distance(s,r)+"",satHoverBoxNode3.textContent=""):"Star"===s.type?(null!==starManager.findStarsConstellation(s.name)?satHoverBoxNode1.innerHTML=s.name+"</br>"+starManager.findStarsConstellation(s.name):satHoverBoxNode1.textContent=s.name,satHoverBoxNode2.innerHTML=s.type,satHoverBoxNode3.innerHTML="RA: "+s.ra.toFixed(3)+" deg </br> DEC: "+s.dec.toFixed(3)+" deg",starManager.drawConstellations(starManager.findStarsConstellation(s.name))):(satHoverBoxNode1.textContent=s.name,satHoverBoxNode2.innerHTML=s.type+satellite.distance(s,r)+"",satHoverBoxNode3.textContent="");else s.missile?(satHoverBoxNode1.innerHTML=s.ON+"<br >"+s.desc,satHoverBoxNode2.textContent="",satHoverBoxNode3.textContent=""):objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()&&isShowNextPass&&T?(satHoverBoxNode1.textContent=s.ON,satHoverBoxNode2.textContent=s.SCC_NUM,satHoverBoxNode3.innerHTML=satellite.nextpass(s)+satellite.distance(s,r)+""):T?(satHoverBoxNode1.textContent=s.ON,satHoverBoxNode2.innerHTML=s.SCC_NUM+satellite.distance(s,r)+"",satHoverBoxNode3.innerHTML="X: "+s.position.x.toFixed(2)+" Y: "+s.position.y.toFixed(2)+" Z: "+s.position.z.toFixed(2)+"</br>X: "+s.velocityX.toFixed(2)+"km/s Y: "+s.velocityY.toFixed(2)+"km/s Z: "+s.velocityZ.toFixed(2)+"km/s"):objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()&&isShowNextPass?(satHoverBoxNode1.textContent=s.ON,satHoverBoxNode2.textContent=s.SCC_NUM,satHoverBoxNode3.textContent=satellite.nextpass(s)):(satHoverBoxNode1.textContent=s.ON,satHoverBoxNode2.textContent=s.SCC_NUM,satHoverBoxNode3.innerHTML="X: "+s.position.x.toFixed(2)+" Y: "+s.position.y.toFixed(2)+" Z: "+s.position.z.toFixed(2)+"</br>X: "+s.velocityX.toFixed(2)+" Y: "+s.velocityY.toFixed(2)+" Z: "+s.velocityZ.toFixed(2));satHoverBoxDOM.css({display:"block","text-align":"center",position:"absolute",left:a+20,top:t-10}),canvasDOM.css({cursor:"pointer"})}}var F=0,I=0}();var isSelectedSatNegativeOne=!1;function selectSat(e){var a;if(db.log("selectSat"),db.log(`satId: ${e}`,!0),-1!==e){if("Star"==(a=satSet.getSat(e)).type)return;if((0==a.active||void 0===a.active)&&void 0===a.staticNum)return}if(satSet.selectSat(e),camSnapMode=!1,rotateTheEarth=!1,-1===e&&(settingsManager.currentColorScheme===ColorScheme.group||$("#search").val().length>=3?$("#menu-sat-fov").removeClass("bmenu-item-disabled"):($("#menu-sat-fov").removeClass("bmenu-item-selected"),$("#menu-sat-fov").addClass("bmenu-item-disabled"),settingsManager.isSatOverflyModeOn=!1,satCruncher.postMessage({isShowSatOverfly:"reset"}))),-1!==e||isSelectedSatNegativeOne){if(isSelectedSatNegativeOne=!1,selectedSat=e,!(a=satSet.getSatExtraOnly(e)))return;if("Star"==a.type)return;if(a.static){if(void 0===a.staticNum)return;return adviceList.sensor(),a=satSet.getSat(e),objectManager.isSensorManagerLoaded&&sensorManager.setSensor(null,a.staticNum),objectManager.isSensorManagerLoaded&&(sensorManager.curSensorPositon=[a.position.x,a.position.y,a.position.z]),selectedSat=-1,$("#menu-sensor-info").removeClass("bmenu-item-disabled"),$("#menu-fov-bubble").removeClass("bmenu-item-disabled"),$("#menu-surveillance").removeClass("bmenu-item-disabled"),$("#menu-planetarium").removeClass("bmenu-item-disabled"),$("#menu-astronomy").removeClass("bmenu-item-disabled"),void(-1!==selectedSat&&$("#menu-lookangles").removeClass("bmenu-item-disabled"))}var t,s;camZoomSnappedOnSat=!0,camAngleSnappedOnSat=!0,orbitDisplay.setSelectOrbit(e),objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()&&$("#menu-lookangles").removeClass("bmenu-item-disabled"),$("#menu-lookanglesmultisite").removeClass("bmenu-item-disabled"),$("#menu-satview").removeClass("bmenu-item-disabled"),$("#menu-editSat").removeClass("bmenu-item-disabled"),$("#menu-sat-fov").removeClass("bmenu-item-disabled"),$("#menu-map").removeClass("bmenu-item-disabled"),$("#menu-newLaunch").removeClass("bmenu-item-disabled"),"block"===$("#search-results").css("display")?window.innerWidth<=1e3||($("#search-results").attr("style","display:block; max-height:27%"),cameraType.current,cameraType.PLANETARIUM):window.innerWidth<=1e3||($("#search-results").attr("style","max-height:27%"),cameraType.current,cameraType.PLANETARIUM),a.missile?$(".sat-only-info").hide():$(".sat-only-info").show(),$("#sat-infobox").fadeIn(),$("#sat-info-title").html(a.ON),a.URL&&""!==a.URL&&$("#sat-info-title").html("<a class='iframe' href='"+a.URL+"'>"+a.ON+"</a>"),$("#edit-satinfo-link").html("<a class='iframe' href='editor.htm?scc="+a.SCC_NUM+"&popup=true'>Edit Satellite Info</a>"),$("#sat-intl-des").html(a.intlDes),"unknown"===a.OT?$("#sat-objnum").html(1+a.TLE2.substr(2,7).toString()):($("#sat-objnum").html(a.SCC_NUM),ga("send","event","Satellite","SCC: "+a.SCC_NUM,"SCC Number")),0===a.OT&&(t="TBA"),1===a.OT&&(t="Payload"),2===a.OT&&(t="Rocket Body"),3===a.OT&&(t="Debris"),4===a.OT&&(t="Amateur Report"),a.missile&&(t="Ballistic Missile"),$("#sat-type").html(t),s=objectManager.extractCountry(a.C),$("#sat-country").html(s);var r,i,n,o=[];if(a.missile?(i=(o=a.desc.split("("))[0].substr(0,o[0].length-1),r=a.desc.split("(")[1].split(")")[0],o.site=i,o.sitec=a.C):o=objectManager.extractLaunchSite(a.LS),$("#sat-site").html(o.site),$("#sat-sitec").html(o.sitec),ga("send","event","Satellite","Country: "+s,"Country"),ga("send","event","Satellite","Site: "+o,"Site"),a.missile?(a.LV=r,$("#sat-vehicle").html(a.LV)):($("#sat-vehicle").html(a.LV),"U"===a.LV&&$("#sat-vehicle").html("Unknown"),objectManager.extractLiftVehicle(a.LV)),null===a.R||void 0===a.R)$("#sat-rcs").html("Unknown");else a.R<.1&&(n="Small"),a.R>=.1&&(n="Medium"),a.R>1&&(n="Large"),$("#sat-rcs").html(n),$("#sat-rcs").tooltip({delay:50,html:a.R,position:"left"});if(!a.missile){$("a.iframe").colorbox({iframe:!0,width:"80%",height:"80%",fastIframe:!1,closeButton:!1}),$("#sat-apogee").html(a.apogee.toFixed(0)+" km"),$("#sat-perigee").html(a.perigee.toFixed(0)+" km"),$("#sat-inclination").html((a.inclination*RAD2DEG).toFixed(2)+"Â°"),$("#sat-eccentricity").html(a.eccentricity.toFixed(3)),$("#sat-period").html(a.period.toFixed(2)+" min"),$("#sat-period").tooltip({delay:50,html:"Mean Motion: "+MINUTES_PER_DAY/a.period.toFixed(2),position:"left"}),void 0!==a.U&&""!=a.U?$("#sat-user").html(a.U):$("#sat-user").html("Unknown"),void 0!==a.P&&""!=a.P?$("#sat-purpose").html(a.P):$("#sat-purpose").html("Unknown"),void 0!==a.Con&&""!=a.Con?$("#sat-contractor").html(a.Con):$("#sat-contractor").html("Unknown"),void 0!==a.LM&&""!=a.LM?$("#sat-lmass").html(a.LM+" kg"):$("#sat-lmass").html("Unknown"),void 0!==a.DM&&""!=a.DM?$("#sat-dmass").html(a.DM+" kg"):$("#sat-dmass").html("Unknown"),void 0!==a.Li&&""!=a.Li?$("#sat-life").html(a.Li+" yrs"):$("#sat-life").html("Unknown"),void 0!==a.Pw&&""!=a.Pw?$("#sat-power").html(a.Pw+" w"):$("#sat-power").html("Unknown"),void 0!==a.vmag&&""!=a.vmag?$("#sat-vmag").html(a.vmag):$("#sat-vmag").html("Unknown"),void 0!==a.S1&&""!=a.S1?($("#sat-source1").html(`<a class="iframe" href="${a.S1}">${a.S1.split("//").splice(1)}</a>`),$("#sat-source1w").show()):($("#sat-source1").html("Unknown"),$("#sat-source1w").hide()),void 0!==a.S2&&""!=a.S2?($("#sat-source2").html(`<a class="iframe" href="${a.S2}">${a.S2.split("//").splice(1)}</a>`),$("#sat-source2w").show()):($("#sat-source2").html("Unknown"),$("#sat-source2w").hide()),void 0!==a.S3&&""!=a.S3?($("#sat-source3").html(`<a class="iframe" href="${a.S3}">${a.S3.split("//").splice(1)}</a>`),$("#sat-source3w").show()):($("#sat-source3").html("Unknown"),$("#sat-source3w").hide()),void 0!==a.S4&&""!=a.S4?($("#sat-source4").html(`<a class="iframe" href="${a.S4}">${a.S4.split("//").splice(1)}</a>`),$("#sat-source4w").show()):($("#sat-source4").html("Unknown"),$("#sat-source4w").hide()),void 0!==a.S5&&""!=a.S5?($("#sat-source5").html(`<a class="iframe" href="${a.S5}">${a.S5.split("//").splice(1)}</a>`),$("#sat-source5w").show()):($("#sat-source5").html("Unknown"),$("#sat-source5w").hide()),void 0!==a.S6&&""!=a.S6?($("#sat-source6").html(`<a class="iframe" href="${a.S6}">${a.S6.split("//").splice(1)}</a>`),$("#sat-source6w").show()):($("#sat-source6").html("Unknown"),$("#sat-source6w").hide()),void 0!==a.S7&&""!=a.S7?($("#sat-source7").html(`<a class="iframe" href="${a.S7}">${a.S7.split("//").splice(1)}</a>`),$("#sat-source7w").show()):($("#sat-source7").html("Unknown"),$("#sat-source7w").hide()),void 0!==a.URL&&""!=a.URL?($("#sat-sourceURL").html(`<a class="iframe" href="${a.URL}">${a.URL.split("//").splice(1)}</a>`),$("#sat-source8w").show()):($("#sat-source8").html("Unknown"),$("#sat-source8w").hide()),$("a.iframe").colorbox({iframe:!0,width:"80%",height:"80%",fastIframe:!1,closeButton:!1});var c,d=new Date,l=timeManager.getDayOfYear(d);if(d=(d=d.getFullYear()).toString().substr(2,2),c=satSet.getSat(e).TLE1.substr(18,2)===d?l-satSet.getSat(e).TLE1.substr(20,3):l-satSet.getSat(e).TLE1.substr(20,3)+365*satSet.getSat(e).TLE1.substr(17,2),$("#sat-elset-age").html(c+" Days"),$("#sat-elset-age").tooltip({delay:50,html:"Epoch Year: "+a.TLE1.substr(18,2).toString()+" Day: "+a.TLE1.substr(20,8).toString(),position:"left"}),objectManager.isSensorManagerLoaded){d=new Date(timeManager.propRealTime+timeManager.propOffset);var m=SunCalc.getTimes(d,sensorManager.currentSensor.lat,sensorManager.currentSensor.long),p=a.isInSun;sensorManager.checkSensorSelected()?"Optical"!==sensorManager.currentSensor.type&&"Observer"!==sensorManager.currentSensor.type?$("#sat-sun").html("No Effect"):m.dawn.getTime()-d>0||m.dusk.getTime()-d<0?(0==p&&$("#sat-sun").html("No Sunlight"),1==p&&$("#sat-sun").html("Limited Sunlight"),2==p&&$("#sat-sun").html("Direct Sunlight")):"Invalid Date"==m.night||"Invalid Date"!=m.dawn&&"Invalid Date"!=m.dusk?$("#sat-sun").html("Sun Exclusion"):(0==p&&$("#sat-sun").html("No Sunlight"),1==p&&$("#sat-sun").html("Limited Sunlight"),2==p&&$("#sat-sun").html("Direct Sunlight")):(0==p&&$("#sat-sun").html("No Sunlight"),1==p&&$("#sat-sun").html("Limited Sunlight"),2==p&&$("#sat-sun").html("Direct Sunlight"))}else $("#sat-sun").parent().hide()}objectManager.isSensorManagerLoaded&&sensorManager.checkSensorSelected()&&isLookanglesMenuOpen&&satellite.getlookangles(a)}else isSelectedSatNegativeOne=!0,$("#sat-infobox").fadeOut(),orbitDisplay.clearSelectOrbit(),$("#menu-lookanglesmultisite").removeClass("bmenu-item-selected"),$("#menu-lookangles").removeClass("bmenu-item-selected"),$("#menu-editSat").removeClass("bmenu-item-selected"),$("#menu-map").removeClass("bmenu-item-selected"),$("#menu-newLaunch").removeClass("bmenu-item-selected"),$("#menu-breakup").removeClass("bmenu-item-selected"),$("#menu-customSensor").removeClass("bmenu-item-selected"),$("#menu-lookanglesmultisite").addClass("bmenu-item-disabled"),$("#menu-lookangles").addClass("bmenu-item-disabled"),$("#menu-satview").addClass("bmenu-item-disabled"),$("#menu-editSat").addClass("bmenu-item-disabled"),$("#menu-map").addClass("bmenu-item-disabled"),$("#menu-newLaunch").addClass("bmenu-item-disabled"),$("#menu-breakup").addClass("bmenu-item-disabled"),$("#editSat-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#map-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#newLaunch-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#breakup-menu").effect("slide",{direction:"left",mode:"hide"},1e3),$("#customSensor-menu").effect("slide",{direction:"left",mode:"hide"},1e3),isEditSatMenuOpen=!1,isLookanglesMenuOpen=!1,settingsManager.isMapMenuOpen=!1,isLookanglesMultiSiteMenuOpen=!1,isNewLaunchMenuOpen=!1,isBreakupMenuOpen=!1,isMissileMenuOpen=!1,isCustomSensorMenuOpen=!1;selectedSat=e,-1!==e&&(void 0!==a.TTP?($("#sat-ttp-wrapper").show(),$("#sat-ttp").html(a.TTP)):$("#sat-ttp-wrapper").hide(),void 0!==a.NOTES?($("#sat-notes-wrapper").show(),$("#sat-notes").html(a.NOTES)):$("#sat-notes-wrapper").hide(),void 0!==a.FMISSED?($("#sat-fmissed-wrapper").show(),$("#sat-fmissed").html(a.FMISSED)):$("#sat-fmissed-wrapper").hide(),void 0!==a.ORPO?($("#sat-oRPO-wrapper").show(),$("#sat-oRPO").html(a.ORPO)):$("#sat-oRPO-wrapper").hide(),void 0!==a.constellation?($("#sat-constellation-wrapper").show(),$("#sat-constellation").html(a.constellation)):$("#sat-constellation-wrapper").hide(),void 0!==a.maneuver?($("#sat-maneuver-wrapper").show(),$("#sat-maneuver").html(a.maneuver)):$("#sat-maneuver-wrapper").hide(),void 0!==a.associates?($("#sat-associates-wrapper").show(),$("#sat-associates").html(a.associates)):$("#sat-associates-wrapper").hide(),uiManager.updateMap())}function enableSlowCPUMode(){db.log("enableSlowCPUMode"),settingsManager.cruncherReady&&(settingsManager.isSlowCPUModeEnabled=!0,settingsManager.minimumSearchCharacters=3,settingsManager.satLabelInterval=500,satCruncher.postMessage({isSlowCPUModeEnabled:!0}))}function debugDrawLine(e,a,t){switch(void 0===t&&(t=[1,0,1,1]),t){case"r":t=[1,0,0,1];break;case"o":t=[1,.5,0,1];break;case"y":t=[1,1,0,1];break;case"g":t=[0,1,0,1];break;case"b":t=[0,0,1,1];break;case"c":t=[0,1,1,1];break;case"p":t=[1,0,1,1]}if("sat"==e){let e=satSet.getSat(a);drawLineList.push({line:new Line,sat:e,ref:[0,0,0],ref2:[e.position.x,e.position.y,e.position.z],color:t})}if("sat2"==e){let e=satSet.getSat(a[0]);drawLineList.push({line:new Line,sat:e,ref:[a[1],a[2],a[3]],ref2:[e.position.x,e.position.y,e.position.z],color:t})}if("sat3"==e){let e=satSet.getSat(a[0]);var s=satSet.getSat(a[1]);drawLineList.push({line:new Line,sat:e,sat2:s,ref:[e.position.x,e.position.y,e.position.z],ref2:[s.position.x,s.position.y,s.position.z],color:t})}"ref"==e&&drawLineList.push({line:new Line,ref:[0,0,0],ref2:[a[0],a[1],a[2]],color:t}),"ref2"==e&&drawLineList.push({line:new Line,ref:[a[0],a[1],a[2]],ref2:[a[3],a[4],a[5]],color:t})}var tempStar1,tempStar2,satPos,drawLinesI=0;function drawLines(){if(0!=drawLineList.length)for(drawLinesI=0;drawLinesI<drawLineList.length;drawLinesI++)void 0!==drawLineList[drawLinesI].sat?(drawLineList[drawLinesI].sat=satSet.getSatPosOnly(drawLineList[drawLinesI].sat.id),void 0!==drawLineList[drawLinesI].sat2?void 0!==drawLineList[drawLinesI].sat2.name?(void 0===drawLineList[drawLinesI].sat2.id&&(drawLineList[drawLinesI].sat2.id=satSet.getIdFromSensorName(drawLineList[drawLinesI].sat2.name)),drawLineList[drawLinesI].sat2=satSet.getSatPosOnly(drawLineList[drawLinesI].sat2.id),drawLineList[drawLinesI].line.set([drawLineList[drawLinesI].sat.position.x,drawLineList[drawLinesI].sat.position.y,drawLineList[drawLinesI].sat.position.z],[drawLineList[drawLinesI].sat2.position.x,drawLineList[drawLinesI].sat2.position.y,drawLineList[drawLinesI].sat2.position.z])):(drawLineList[drawLinesI].sat2=satSet.getSatPosOnly(drawLineList[drawLinesI].sat2.id),drawLineList[drawLinesI].line.set([drawLineList[drawLinesI].sat.position.x,drawLineList[drawLinesI].sat.position.y,drawLineList[drawLinesI].sat.position.z],[drawLineList[drawLinesI].sat2.position.x,drawLineList[drawLinesI].sat2.position.y,drawLineList[drawLinesI].sat2.position.z])):drawLineList[drawLinesI].line.set(drawLineList[drawLinesI].ref,[drawLineList[drawLinesI].sat.position.x,drawLineList[drawLinesI].sat.position.y,drawLineList[drawLinesI].sat.position.z])):void 0!==drawLineList[drawLinesI].star1&&void 0!==drawLineList[drawLinesI].star2?(void 0===drawLineList[drawLinesI].star1ID&&(drawLineList[drawLinesI].star1ID=satSet.getIdFromStarName(drawLineList[drawLinesI].star1)),void 0===drawLineList[drawLinesI].star2ID&&(drawLineList[drawLinesI].star2ID=satSet.getIdFromStarName(drawLineList[drawLinesI].star2)),tempStar1=satSet.getSatPosOnly(drawLineList[drawLinesI].star1ID),tempStar2=satSet.getSatPosOnly(drawLineList[drawLinesI].star2ID),drawLineList[drawLinesI].line.set([tempStar1.position.x,tempStar1.position.y,tempStar1.position.z],[tempStar2.position.x,tempStar2.position.y,tempStar2.position.z])):drawLineList[drawLinesI].line.set(drawLineList[drawLinesI].ref,drawLineList[drawLinesI].ref2),drawLineList[drawLinesI].line.draw(drawLineList[drawLinesI].color)}